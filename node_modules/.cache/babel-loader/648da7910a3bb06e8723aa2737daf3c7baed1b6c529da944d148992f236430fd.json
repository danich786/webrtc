{"ast":null,"code":"import _slicedToArray from\"/Users/Dani/Desktop/webrtc/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";// https://www.freecodecamp.org/news/building-a-modern-chat-application-with-react-js-558896622194/\nimport React,{useState,useEffect,useRef}from'react';import DragDrop from'./dragDrop';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Chat=function Chat(props){var _useState=useState(''),_useState2=_slicedToArray(_useState,2),message=_useState2[0],setMessage=_useState2[1];var _useState3=useState({uid:0}),_useState4=_slicedToArray(_useState3,2),user=_useState4[0],setUser=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),imageZoom=_useState6[0],setImageZoom=_useState6[1];var _useState7=useState(''),_useState8=_slicedToArray(_useState7,2),selectedImage=_useState8[0],setSelectedImage=_useState8[1];var scrollToBottom=function scrollToBottom(){var chat=document.getElementById(\"chatList\");chat.scrollTop=chat.scrollHeight;};useEffect(function(){scrollToBottom();setUser({uid:props.user.uid});},[props]);var sendMessage=function sendMessage(msg){props.sendMessage(msg);scrollToBottom();};var handleSubmit=function handleSubmit(event){if(message==='')return;event.preventDefault();sendMessage({type:'text',message:{id:user.uid,sender:{uid:user.uid},data:{text:message}}});setMessage('');};var handleChange=function handleChange(event){setMessage(event.target.value);};var renderMessage=function renderMessage(userType,data){console.log('===========',data);var message=data.message;var msgDiv=data.type==='text'&&/*#__PURE__*/_jsxs(\"div\",{className:\"msg\",children:[/*#__PURE__*/_jsx(\"p\",{children:message.sender.uid}),/*#__PURE__*/_jsxs(\"div\",{className:\"message\",children:[\" \",message.data.text]})]})||/*#__PURE__*/_jsxs(\"div\",{className:\"msg\",children:[/*#__PURE__*/_jsx(\"p\",{children:message.sender.uid}),/*#__PURE__*/_jsx(\"img\",{onClick:function onClick(){setImageZoom(true);setSelectedImage(message.data);},className:\"message\",style:{width:200,// height: 100\ncursor:'pointer'},src:message.data})]});return/*#__PURE__*/_jsx(\"li\",{className:userType,children:msgDiv});};var showEnlargedImage=function showEnlargedImage(data){return/*#__PURE__*/_jsx(\"img\",{src:data,style:{backgroundColor:'black',position:'relative',zIndex:100,display:'block',cursor:'pointer',marginLeft:'auto',marginRight:'auto',padding:20,borderRadius:20},onClick:function onClick(){return setImageZoom(false);}});};return/*#__PURE__*/_jsxs(\"div\",{children:[imageZoom&&showEnlargedImage(selectedImage),/*#__PURE__*/_jsxs(\"div\",{className:\"chatWindow\",style:{zIndex:10,position:'absolute',right:5,top:190,bottom:140,width:350// height: 650,\n},children:[/*#__PURE__*/_jsx(\"ul\",{className:\"chat\",id:\"chatList\",children:props.messages.map(function(data){return/*#__PURE__*/_jsx(\"div\",{children:user.uid===data.message.sender.uid?renderMessage('self',data):renderMessage('other',data)},data.id);})}),/*#__PURE__*/_jsx(DragDrop,{className:\"chatInputWrapper\",sendFiles:function sendFiles(files){var reader=new FileReader();reader.onload=function(e){//https://blog.mozilla.org/webrtc/large-data-channel-messages/\n//https://lgrahl.de/articles/demystifying-webrtc-dc-size-limit.html\nvar maximumMessageSize=262118;//65535 <=== 64KiB // 16384 <=== 16KiB to be safe\nif(e.target.result.length<=maximumMessageSize)sendMessage({type:'image',message:{id:user.uid,sender:{uid:user.uid},data:e.target.result}});else alert('Message exceeds Maximum Message Size!');};reader.readAsDataURL(files[0]);},children:/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"form\",{onSubmit:handleSubmit,children:/*#__PURE__*/_jsx(\"input\",{className:\"textarea input\",type:\"text\",placeholder:\"Enter your message...\",onChange:handleChange,value:message})})})})]})]});};export default Chat;","map":{"version":3,"names":["React","useState","useEffect","useRef","DragDrop","jsx","_jsx","jsxs","_jsxs","Chat","props","_useState","_useState2","_slicedToArray","message","setMessage","_useState3","uid","_useState4","user","setUser","_useState5","_useState6","imageZoom","setImageZoom","_useState7","_useState8","selectedImage","setSelectedImage","scrollToBottom","chat","document","getElementById","scrollTop","scrollHeight","sendMessage","msg","handleSubmit","event","preventDefault","type","id","sender","data","text","handleChange","target","value","renderMessage","userType","console","log","msgDiv","className","children","onClick","style","width","cursor","src","showEnlargedImage","backgroundColor","position","zIndex","display","marginLeft","marginRight","padding","borderRadius","right","top","bottom","messages","map","sendFiles","files","reader","FileReader","onload","e","maximumMessageSize","result","length","alert","readAsDataURL","onSubmit","placeholder","onChange"],"sources":["/Users/Dani/Desktop/webrtc/src/components/chat.js"],"sourcesContent":["// https://www.freecodecamp.org/news/building-a-modern-chat-application-with-react-js-558896622194/\n\nimport React, { useState, useEffect, useRef } from 'react'\nimport DragDrop from './dragDrop'\n\nconst Chat = props => {\n    const [message, setMessage] = useState('')\n    const [user, setUser] = useState({ uid: 0, })\n    const [imageZoom, setImageZoom] = useState(false)\n    const [selectedImage, setSelectedImage] = useState('')\n\n    const scrollToBottom = () => {\n        const chat = document.getElementById(\"chatList\");\n        chat.scrollTop = chat.scrollHeight\n    }\n\n    useEffect(() => {\n        scrollToBottom()\n        setUser({ uid: props.user.uid, })\n    }, [props])\n\n    const sendMessage = (msg) => {\n        props.sendMessage(msg);\n        scrollToBottom()\n    }\n\n    const handleSubmit = event => {\n        if (message === '') return\n        event.preventDefault();\n        sendMessage({type:'text', message: { id: user.uid, sender: { uid: user.uid, }, data: { text: message } }})\n        setMessage('')\n    };\n\n    const handleChange = event => {\n        setMessage(event.target.value)\n    }\n\n    const renderMessage = (userType, data) => {\n        console.log('===========', data)\n        const message = data.message\n\n        const msgDiv = data.type === 'text' && (\n            <div className=\"msg\">\n                <p>{message.sender.uid}</p>\n                <div className=\"message\"> {message.data.text}</div>\n            </div>\n        ) || (\n            <div className=\"msg\">\n                <p>{message.sender.uid}</p>\n                <img\n                    onClick={() => {\n                        setImageZoom(true)\n                        setSelectedImage(message.data)\n                    }}\n                    className=\"message\"\n                    style={{\n                        width: 200,\n                        // height: 100\n                        cursor: 'pointer',\n                    }}\n                    src={message.data} />\n            </div>\n        )\n\n        return (<li className={userType} >{ msgDiv }</li>)\n\n    }\n\n    const showEnlargedImage = (data) => {\n        return (<img\n            src={data}\n            style={{\n                backgroundColor: 'black',\n                position: 'relative',\n                zIndex: 100,\n                display: 'block',\n                cursor: 'pointer',\n                marginLeft: 'auto',\n                marginRight: 'auto',\n                padding: 20,\n                borderRadius: 20,\n            }}\n            onClick={() => setImageZoom(false)}\n        />)\n    }\n\n    return (\n        <div>\n            {imageZoom && showEnlargedImage(selectedImage)}\n\n            <div className=\"chatWindow\" style={{\n                zIndex: 10,\n                position: 'absolute',\n                right: 5,\n                top: 190,\n                bottom: 140,\n                width: 350,\n                // height: 650,\n            }}>\n                <ul className=\"chat\" id=\"chatList\">\n                    {props.messages.map(data => (\n                        <div key={data.id}>\n                            {user.uid === data.message.sender.uid ? renderMessage('self', data) : (renderMessage('other', data))}\n                        </div>\n                    ))}\n                </ul>\n                <DragDrop\n                    className=\"chatInputWrapper\"\n                    sendFiles={(files) => {\n                        const reader = new FileReader()\n                        reader.onload = (e) => {\n                            //https://blog.mozilla.org/webrtc/large-data-channel-messages/\n                            //https://lgrahl.de/articles/demystifying-webrtc-dc-size-limit.html\n                            const maximumMessageSize = 262118 //65535 <=== 64KiB // 16384 <=== 16KiB to be safe\n                            if (e.target.result.length <= maximumMessageSize)\n                                sendMessage({ type: 'image', message: { id: user.uid, sender: { uid: user.uid, }, data: e.target.result } })\n                            else\n                                alert('Message exceeds Maximum Message Size!')\n                        }\n\n                        reader.readAsDataURL(files[0])\n                    }}\n                >\n                    <div>\n                        <form onSubmit={handleSubmit}>\n                            <input\n                                className=\"textarea input\"\n                                type=\"text\"\n                                placeholder=\"Enter your message...\"\n                                onChange={handleChange}\n                                value={message}\n                            />\n                        </form>\n                    </div>\n                </DragDrop>\n            </div>\n        </div>\n    )\n}\n\nexport default Chat\n"],"mappings":"gHAAA;AAEA,MAAO,CAAAA,KAAK,EAAIC,QAAQ,CAAEC,SAAS,CAAEC,MAAM,KAAQ,OAAO,CAC1D,MAAO,CAAAC,QAAQ,KAAM,YAAY,QAAAC,GAAA,IAAAC,IAAA,gCAAAC,IAAA,IAAAC,KAAA,yBAEjC,GAAM,CAAAC,IAAI,CAAG,QAAP,CAAAA,IAAIA,CAAGC,KAAK,CAAI,CAClB,IAAAC,SAAA,CAA8BV,QAAQ,CAAC,EAAE,CAAC,CAAAW,UAAA,CAAAC,cAAA,CAAAF,SAAA,IAAnCG,OAAO,CAAAF,UAAA,IAAEG,UAAU,CAAAH,UAAA,IAC1B,IAAAI,UAAA,CAAwBf,QAAQ,CAAC,CAAEgB,GAAG,CAAE,CAAG,CAAC,CAAC,CAAAC,UAAA,CAAAL,cAAA,CAAAG,UAAA,IAAtCG,IAAI,CAAAD,UAAA,IAAEE,OAAO,CAAAF,UAAA,IACpB,IAAAG,UAAA,CAAkCpB,QAAQ,CAAC,KAAK,CAAC,CAAAqB,UAAA,CAAAT,cAAA,CAAAQ,UAAA,IAA1CE,SAAS,CAAAD,UAAA,IAAEE,YAAY,CAAAF,UAAA,IAC9B,IAAAG,UAAA,CAA0CxB,QAAQ,CAAC,EAAE,CAAC,CAAAyB,UAAA,CAAAb,cAAA,CAAAY,UAAA,IAA/CE,aAAa,CAAAD,UAAA,IAAEE,gBAAgB,CAAAF,UAAA,IAEtC,GAAM,CAAAG,cAAc,CAAG,QAAjB,CAAAA,cAAcA,CAAA,CAAS,CACzB,GAAM,CAAAC,IAAI,CAAGC,QAAQ,CAACC,cAAc,CAAC,UAAU,CAAC,CAChDF,IAAI,CAACG,SAAS,CAAGH,IAAI,CAACI,YAAY,CACtC,CAAC,CAEDhC,SAAS,CAAC,UAAM,CACZ2B,cAAc,CAAC,CAAC,CAChBT,OAAO,CAAC,CAAEH,GAAG,CAAEP,KAAK,CAACS,IAAI,CAACF,GAAK,CAAC,CAAC,CACrC,CAAC,CAAE,CAACP,KAAK,CAAC,CAAC,CAEX,GAAM,CAAAyB,WAAW,CAAG,QAAd,CAAAA,WAAWA,CAAIC,GAAG,CAAK,CACzB1B,KAAK,CAACyB,WAAW,CAACC,GAAG,CAAC,CACtBP,cAAc,CAAC,CAAC,CACpB,CAAC,CAED,GAAM,CAAAQ,YAAY,CAAG,QAAf,CAAAA,YAAYA,CAAGC,KAAK,CAAI,CAC1B,GAAIxB,OAAO,GAAK,EAAE,CAAE,OACpBwB,KAAK,CAACC,cAAc,CAAC,CAAC,CACtBJ,WAAW,CAAC,CAACK,IAAI,CAAC,MAAM,CAAE1B,OAAO,CAAE,CAAE2B,EAAE,CAAEtB,IAAI,CAACF,GAAG,CAAEyB,MAAM,CAAE,CAAEzB,GAAG,CAAEE,IAAI,CAACF,GAAK,CAAC,CAAE0B,IAAI,CAAE,CAAEC,IAAI,CAAE9B,OAAQ,CAAE,CAAC,CAAC,CAAC,CAC1GC,UAAU,CAAC,EAAE,CAAC,CAClB,CAAC,CAED,GAAM,CAAA8B,YAAY,CAAG,QAAf,CAAAA,YAAYA,CAAGP,KAAK,CAAI,CAC1BvB,UAAU,CAACuB,KAAK,CAACQ,MAAM,CAACC,KAAK,CAAC,CAClC,CAAC,CAED,GAAM,CAAAC,aAAa,CAAG,QAAhB,CAAAA,aAAaA,CAAIC,QAAQ,CAAEN,IAAI,CAAK,CACtCO,OAAO,CAACC,GAAG,CAAC,aAAa,CAAER,IAAI,CAAC,CAChC,GAAM,CAAA7B,OAAO,CAAG6B,IAAI,CAAC7B,OAAO,CAE5B,GAAM,CAAAsC,MAAM,CAAGT,IAAI,CAACH,IAAI,GAAK,MAAM,eAC/BhC,KAAA,QAAK6C,SAAS,CAAC,KAAK,CAAAC,QAAA,eAChBhD,IAAA,MAAAgD,QAAA,CAAIxC,OAAO,CAAC4B,MAAM,CAACzB,GAAG,CAAI,CAAC,cAC3BT,KAAA,QAAK6C,SAAS,CAAC,SAAS,CAAAC,QAAA,EAAC,GAAC,CAACxC,OAAO,CAAC6B,IAAI,CAACC,IAAI,EAAM,CAAC,EAClD,CACR,eACGpC,KAAA,QAAK6C,SAAS,CAAC,KAAK,CAAAC,QAAA,eAChBhD,IAAA,MAAAgD,QAAA,CAAIxC,OAAO,CAAC4B,MAAM,CAACzB,GAAG,CAAI,CAAC,cAC3BX,IAAA,QACIiD,OAAO,CAAE,SAAAA,QAAA,CAAM,CACX/B,YAAY,CAAC,IAAI,CAAC,CAClBI,gBAAgB,CAACd,OAAO,CAAC6B,IAAI,CAAC,CAClC,CAAE,CACFU,SAAS,CAAC,SAAS,CACnBG,KAAK,CAAE,CACHC,KAAK,CAAE,GAAG,CACV;AACAC,MAAM,CAAE,SACZ,CAAE,CACFC,GAAG,CAAE7C,OAAO,CAAC6B,IAAK,CAAE,CAAC,EACxB,CACR,CAED,mBAAQrC,IAAA,OAAI+C,SAAS,CAAEJ,QAAS,CAAAK,QAAA,CAAIF,MAAM,CAAM,CAAC,CAErD,CAAC,CAED,GAAM,CAAAQ,iBAAiB,CAAG,QAApB,CAAAA,iBAAiBA,CAAIjB,IAAI,CAAK,CAChC,mBAAQrC,IAAA,QACJqD,GAAG,CAAEhB,IAAK,CACVa,KAAK,CAAE,CACHK,eAAe,CAAE,OAAO,CACxBC,QAAQ,CAAE,UAAU,CACpBC,MAAM,CAAE,GAAG,CACXC,OAAO,CAAE,OAAO,CAChBN,MAAM,CAAE,SAAS,CACjBO,UAAU,CAAE,MAAM,CAClBC,WAAW,CAAE,MAAM,CACnBC,OAAO,CAAE,EAAE,CACXC,YAAY,CAAE,EAClB,CAAE,CACFb,OAAO,CAAE,SAAAA,QAAA,QAAM,CAAA/B,YAAY,CAAC,KAAK,CAAC,EAAC,CACtC,CAAC,CACN,CAAC,CAED,mBACIhB,KAAA,QAAA8C,QAAA,EACK/B,SAAS,EAAIqC,iBAAiB,CAACjC,aAAa,CAAC,cAE9CnB,KAAA,QAAK6C,SAAS,CAAC,YAAY,CAACG,KAAK,CAAE,CAC/BO,MAAM,CAAE,EAAE,CACVD,QAAQ,CAAE,UAAU,CACpBO,KAAK,CAAE,CAAC,CACRC,GAAG,CAAE,GAAG,CACRC,MAAM,CAAE,GAAG,CACXd,KAAK,CAAE,GACP;AACJ,CAAE,CAAAH,QAAA,eACEhD,IAAA,OAAI+C,SAAS,CAAC,MAAM,CAACZ,EAAE,CAAC,UAAU,CAAAa,QAAA,CAC7B5C,KAAK,CAAC8D,QAAQ,CAACC,GAAG,CAAC,SAAA9B,IAAI,qBACpBrC,IAAA,QAAAgD,QAAA,CACKnC,IAAI,CAACF,GAAG,GAAK0B,IAAI,CAAC7B,OAAO,CAAC4B,MAAM,CAACzB,GAAG,CAAG+B,aAAa,CAAC,MAAM,CAAEL,IAAI,CAAC,CAAIK,aAAa,CAAC,OAAO,CAAEL,IAAI,CAAE,EAD9FA,IAAI,CAACF,EAEV,CAAC,EACT,CAAC,CACF,CAAC,cACLnC,IAAA,CAACF,QAAQ,EACLiD,SAAS,CAAC,kBAAkB,CAC5BqB,SAAS,CAAE,SAAAA,UAACC,KAAK,CAAK,CAClB,GAAM,CAAAC,MAAM,CAAG,GAAI,CAAAC,UAAU,CAAC,CAAC,CAC/BD,MAAM,CAACE,MAAM,CAAG,SAACC,CAAC,CAAK,CACnB;AACA;AACA,GAAM,CAAAC,kBAAkB,CAAG,MAAM,CAAC;AAClC,GAAID,CAAC,CAACjC,MAAM,CAACmC,MAAM,CAACC,MAAM,EAAIF,kBAAkB,CAC5C7C,WAAW,CAAC,CAAEK,IAAI,CAAE,OAAO,CAAE1B,OAAO,CAAE,CAAE2B,EAAE,CAAEtB,IAAI,CAACF,GAAG,CAAEyB,MAAM,CAAE,CAAEzB,GAAG,CAAEE,IAAI,CAACF,GAAK,CAAC,CAAE0B,IAAI,CAAEoC,CAAC,CAACjC,MAAM,CAACmC,MAAO,CAAE,CAAC,CAAC,KAE5G,CAAAE,KAAK,CAAC,uCAAuC,CAAC,CACtD,CAAC,CAEDP,MAAM,CAACQ,aAAa,CAACT,KAAK,CAAC,CAAC,CAAC,CAAC,CAClC,CAAE,CAAArB,QAAA,cAEFhD,IAAA,QAAAgD,QAAA,cACIhD,IAAA,SAAM+E,QAAQ,CAAEhD,YAAa,CAAAiB,QAAA,cACzBhD,IAAA,UACI+C,SAAS,CAAC,gBAAgB,CAC1Bb,IAAI,CAAC,MAAM,CACX8C,WAAW,CAAC,uBAAuB,CACnCC,QAAQ,CAAE1C,YAAa,CACvBE,KAAK,CAAEjC,OAAQ,CAClB,CAAC,CACA,CAAC,CACN,CAAC,CACA,CAAC,EACV,CAAC,EACL,CAAC,CAEd,CAAC,CAED,cAAe,CAAAL,IAAI"},"metadata":{},"sourceType":"module","externalDependencies":[]}